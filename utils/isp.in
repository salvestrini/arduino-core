#!/bin/sh

me="dragonisp"

input=$1
output="${input}.hex"

if test x"$input" = x"" ; then
    echo "$me: Missing input file"
    exit 1
fi

@AVR_OBJCOPY@ -O ihex -R .eeprom $input $output || {
    echo "$me: Cannot transform input file"
    exit 1
}

#@AVR_DUDE@ -v -v -v -v -V -c dragon_isp -p m168 -b 57600 -P /dev/ttyUSB0 -U flash:w:$output || {

AVRBASE=../../local
ISPTYPE=arduino

$AVRBASE/bin/avrdude -C $AVRBASE/etc/avrdude.conf -D -F -V -c $ISPTYPE -b 57600 -p m168  -P /dev/ttyUSB0 -U flash:w:$output || {
    echo "$me: Cannot program device"
    exit 1
}

rm -f $output
exit 0
