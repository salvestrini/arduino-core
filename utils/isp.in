#!/bin/sh

me="isp"

input=$1
output="${input}.hex"

if test x"$input" = x"" ; then
    echo "$me: Missing input file"
    exit 1
fi

@AVR_OBJCOPY_EXECUTABLE@ -O ihex -R .eeprom $input $output || {
    echo "$me: Cannot transform input file \`$input'"
    exit 1
}

@AVR_SIZE_EXECUTABLE@ -d $input

AVRDUDE_VERBOSITY=""

@AVRDUDE_EXECUTABLE@ $AVRDUDE_VERBOSITY -D -F -V -c arduino -b @AVRDUDE_SPEED@ -p @AVRDUDE_FAMILY@ -P @AVRDUDE_DEVICE@ -U flash:w:$output || {
    echo "$me: Cannot program device on \`@AVRDUDE_DEVICE@'"
    exit 1
}

rm -f $output
exit 0
